{"version":3,"sources":["../../src/utils/Models.js"],"names":[],"mappings":"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","file":"Models.js","sourcesContent":["import { Observable, Subscriber } from 'rxjs';\nimport { tryCatch } from 'rxjs/util/tryCatch';\nimport { errorObject } from 'rxjs/util/errorObject';\nimport { default as pathSyntax } from 'reaxtor-falcor-syntax-path';\n\nexport class Models extends Observable {\n    constructor(source, operator) {\n        if (typeof source !== 'function') {\n            super();\n            source && (this.source = source);\n            operator && (this.operator = operator);\n        } else {\n            super(source);\n        }\n    }\n    static from(source) {\n        return new Models(source);\n    }\n    lift(operator) {\n        return new Models(this, operator);\n    }\n    deref(...keys) {\n        if (keys.length === 1) {\n            if (Array.isArray(keys[0])) {\n                keys = keys[0];\n            } else if(typeof keys[0] === 'string') {\n                keys = keys[0];\n                if (!isNaN(+keys)) {\n                    keys = [keys];\n                } else {\n                    keys = pathSyntax(keys);\n                }\n            }\n        }\n        return (keys.length === 0 ? this : this.lift(new DerefOperator(keys)));\n    }\n}\n\nclass DerefOperator {\n    constructor(keys) {\n        this.keys = keys;\n    }\n    call(subscriber, source) {\n        return source._subscribe(new DerefSubscriber(subscriber, this.keys));\n    }\n}\n\nclass DerefSubscriber extends Subscriber {\n    constructor(destination, keys) {\n        super(destination);\n        this.keys = keys;\n    }\n    // warn(message, ...values) {\n    //     const { depth, debug } = this;\n    //     if (debug.enabled) {\n    //         debug.color = 'black';\n    //         debug.log = console.warn.bind(console);\n    //         debug(`${pad(message, 10 + (depth * 4))} |---- ${values.join(' ')}`);\n    //     }\n    //     return values[values.length - 1];\n    // }\n    _next(arrayWrapper) {\n\n        let keysIdx = -1;\n        const { keys } = this;\n        const count = keys.length - 1;\n        let [model, props] = arrayWrapper;\n\n        while (++keysIdx <= count) {\n\n            const key = keys[keysIdx];\n\n            if (props == null || typeof props !== 'object' || !props.hasOwnProperty(key)) {\n                const _path = model._path.concat(keys.slice(keysIdx));\n                // this.warn(`cache miss`, this.component.key);\n                // if (model._path.length > 0) {\n                //     this.warn(`from`, JSON.stringify(model._path));\n                // }\n                // this.warn(`attempted`, JSON.stringify(_path));\n                props = undefined;\n                model = model._clone({ _path });\n                break;\n            }\n\n            const nextProps = props[key];\n            const nextModel = tryCatch(model.deref).call(model, nextProps);\n            if (nextModel === errorObject) {\n                const { e } = errorObject;\n                debugger;\n                // this.warn('error', e && e.message || e);\n                // this.warn('component', this.component.key);\n                // if (model._path.length > 0) {\n                //     this.warn('from', JSON.stringify(model._path));\n                // }\n                // this.warn('attempted', JSON.stringify(model._path.concat(keys.slice(keysIdx))));\n                // this.warn('data', inspect(nextProps, { depth: null }));\n                // this.warn('parent', inspect(props, { depth: null }));\n                // this.warn('stack', e && e.stack || e);\n                return this.destination.error(errorObject.e);\n            }\n\n            props = nextProps;\n            model = nextModel;\n        }\n\n        super._next([model, props]);\n    }\n}\n"]}